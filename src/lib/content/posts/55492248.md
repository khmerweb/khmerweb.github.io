---
id: '55492248'
title: 'កែប្រែ​ទំព័រ​ស្តាទិក'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-09-04T13:28:23'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ស្តាទិក'
videos: ''
---
<p>ការកែប្រែ​ទំព័រ​ស្តាទិក​ក៏​ត្រូវ​ធ្វើ​ឡើង​ជា​ពីរ​ដំណាក់កាល​ដែរ ដំណាក់កាល​ទី​មួយ​គឺ​ត្រូវ​ស្រង់​យក​ទិន្នន័យ​នៃ​ទំព័រ​ស្តាទិក​ត្រូវ​កែប្រែ​​មក​ដាក់​បង្ហាញ​នៅ​លើ​គំរូ​ទំព័រ​ស្តាទិក​។ ដំណាក់កាល​ទី​ពីរ​គឺ​ការកែប្រែ​ទិន្នន័យ​នៃ​ទំព័រ​នេះ និង​បញ្ជូន​វា​ទៅ​រក្សា​ទុក​នៅ​ក្នុង​មូលដ្ឋាន​ទិន្នន័យ ជំនួស​អោយ​ទិន្នន័យ​នៃ​ទំព័រ​ស្តាទិក​ចាស់​។ ការស្រង់​យក​ទិន្នន័យ​នៃ​ទំព័រ​ស្តាទិក អាច​ត្រូវ​ធ្វើ​ឡើង​នៅ​ក្នុង​​ឯកសារ [id].astro នៅ​ក្នុង​ថត src/pages/admin/page/edit ។</p><p>&nbsp;</p><p>ដូចគ្នា​ដែរ ការប្រែទិន្នន័យ​នៃ​ទំព័រ​ស្តាទិក​ណា​មួយ​អាច​ត្រូវ​ធ្វើ​ឡើង​បាន​តែ​ចំពោះ​អ្នក​និពន្ធ​ទាំងឡាយ​ណា​ដែល​មាន​តួនាទី​ជា Admin តែ​ប៉ុណ្ណោះ អ្នក​ក្រៅ​ពី​នេះ នឹង​មិន​អាច​កែប្រែ​ទិន្នន័យ​ប្រភេទ​នេះ​បាន​ឡើយ​។</p><pre><code class="js javascript js-code">// src/models/page.js
import prisma from './prisma.js'

class Page{
    ...
    async paginatePages(page, amount){
        const pages = await prisma.page.findMany({ 
            orderBy: { date: "desc" },
            skip: amount * (page-1),
            take: amount
        })

        return pages
    }
    
    async updatePage(page, params){
        let newvalue = {
            title: page.title,
            content: page.content,
            thumb: page.thumb,
            date: page.date,
        }
     
        await prisma.page.update({ where: {id: params.id }, data: newvalue })
    }
    ...
}

export default new Page()</code></pre><pre><code class="js javascript js-code">&lt;!--src/pages/admin/page/edit/[id].astro--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../../../components/admin/Layout.astro"
import Page from "../../../../components/admin/Page-edit.svelte"
import pageDb from "../../../../models/page.js"
import setup from "../../../../settings.js"

let form = null

if(Astro.request.method === "POST"){
    form = {}
    const formData = await Astro.request.formData()
    const title = formData.get('title')
    const content = formData.get('content')
    const thumb = formData.get("thumb")
    const date = formData.get("datetime")

    const validate = (
        typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
        typeof content === 'string' &amp;&amp; content !== '' &amp;&amp;
        typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
        typeof date === 'string' &amp;&amp; date !== ''
    )

    if(validate){
        if(user.role === 'Admin'){
            const page = {title, content, thumb, date}
            await pageDb.updatePage(page, Astro.params)
            form.info = 'ការកែប្រែ​សំរេច​បាន​ដោយ​ជោគជ័យ!'
            form.success = true
        }else{
            form.info = 'អ្នក​គ្មាន​សិទ្ធិ​កែប្រែ​​ទំព័រ​ស្តាទិក​​ឡើយ!'
            form.success = false
        }
    }else{
        form.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
        form.success = false
    }
}

const settings = await setup()
const params = Astro.url.searchParams
const navPage = params.get("p")
const page = await pageDb.getPage(Astro.params)
const items = await pageDb.paginatePages(parseInt(navPage), settings.dashboard)
const count = await pageDb.count()
const pageNumber = Math.ceil(count/settings.dashboard)

const data = { user, count, page, items, info:"ទំព័រ​ស្តាទិក", type:"page", pageNumber, form, navPage }
---
 
&lt;Layout title="ទំព័រ​ស្តាទិក" data={data} &gt;
    &lt;Page slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>