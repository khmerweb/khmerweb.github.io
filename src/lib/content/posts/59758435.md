---
id: '59758435'
title: 'កែប្រែ​ឯកសារ MD'
categories: 'Node.js, Sveltekit'
thumb: ''
date: '2025-10-02T12:09:12'
bookTitle: 'Desktop App with Electron'
bookThumb: ''
bookChapter: 'Electron & SvelteKit'
videos: ''
---
<p>មុន​នឹង​អាច​កែតំរូវ​ឯកសារ​ណាមួយ​បាន យើង​ចាំបាច់​ត្រូវ​ស្រង់​យក​ទិន្នន័យ​របស់​ឯកសារ​នោះ​មក​បង្ហាញ​នៅ​ក្នុងផ្ទាំង​ Editor ជា​មុន​សិន បាន​ន័យ​ថា ទិន្នន័យ​របស់ឯកសារ​ត្រូវ​កែប្រែ ត្រូវ​មាន​នៅ​លើ​ផ្ទាំង​ Editor ។ កត្តា​នេះ​ទាមទារ​​អោយ​យើង​ត្រូវ​សរសេរ​កូដ​ស្រង់​យក​ទិន្នន័យ​នៃ​ឯកសារ​ដែល​ត្រូវ​កែប្រែ​ជា​មុន​សិន​។</p><pre><code class="js javascript js-code">// electron/preload.cjs
const { contextBridge, ipcRenderer } = require('electron')

contextBridge.exposeInMainWorld('electronAPI', {
    getWindowHeight: () =&gt; ipcRenderer.invoke('get-window-height'),
    onUpdateWindowHeight: (callback) =&gt; ipcRenderer.on('update-window-height', callback),
    saveFile: (fileContent, filePath) =&gt; ipcRenderer.invoke('save-file', fileContent, filePath),
    getFiles: () =&gt; ipcRenderer.invoke('get-files'),
    getFile: (filePath) =&gt; ipcRenderer.invoke('get-file', filePath),
})</code></pre><pre><code class="typescript">// electron/main.ts
import { app, BrowserWindow, Menu, ipcMain, dialog } from 'electron';
...
import fileTools from "./file-utils.ts";
...
ipcMain.handle('get-file', async (event, filePath) =&gt; {
    const result = await fileTools.getFile(filePath);
    return result
})</code></pre><pre><code class="typescript">// electron/file-utils.ts
...
class FileTools{
	async saveFile(fileContents:string, file_path:string, dialog:any){
        let fileContent = JSON.parse(fileContents)
        const frontMatter = fileContent.frontMatter

        if(file_path.length){
            const filName = path.basename(file_path)
            const lastDotIndex = filName.lastIndexOf('.');
            frontMatter.id = filName.substring(0, lastDotIndex);
        }else{
            frontMatter.id = randomUUID()
        }
        
        const id = frontMatter.id

        const content = fileContent.content
        const yamlFrontMatter = Object.entries(frontMatter)
            .map(([key, value]) =&gt; {
                if (Array.isArray(value)) {
                    return `${key}:\n${value.map(item =&gt; `  - '${item}'`).join('\n')}`
                }
                const safeValue = String(value).replace(/'/g, "''").replace(/\r?\n|\r/g, ' ')
                return `${key}: '${safeValue}'`
            })
            .join('\n')

        fileContent = `---\n${yamlFrontMatter}\n---\n${content}`
    
        if(!file_path.length){
            const { canceled, filePath } = await dialog.showSaveDialog({
                title: 'Save File',
                defaultPath: `${id}.md`,
                filters: [
                    { name: 'Markdown Files', extensions: ['md'] },
                    { name: 'All Files', extensions: ['*'] }
                ]
            })

            if (!canceled &amp;&amp; filePath) {
                try {
                    fs.writeFileSync(filePath, fileContent)
                    const folderPath = path.dirname(filePath)
                    store.set('folderPath', folderPath);
                    return { success: true, filePath }
                } catch (error: any) {
                    console.error('Failed to save file:', error)
                    return { success: false, error: error.message }
                }
            } else {
                return { success: false, canceled: true }
            }
        }else{
            try {
                fs.writeFileSync(file_path, fileContent)
                return { success: true, filePath:file_path }
            } catch (error: any) {
                console.error('Failed to save file:', error)
                return { success: false, error: error.message }
            }
        }
    }
	...
	async getFile(filePath: string){
        try {
            const data = fs.readFileSync(filePath, 'utf8')
            const result = matter(data)
            return result
        } catch (error) {
            console.error('Failed to read file:', error)
            throw error
        }
    }
}

export default new FileTools()</code></pre><pre><code class="svelte">&lt;!--src/routes/+page.svelte--&gt;
&lt;script lang="ts"&gt;
...
import tool from "./editor-utils";
import { eleState, fileState } from '$lib/store/state.svelte';
...
&lt;/script&gt;

...
&lt;aside&gt;
	&lt;div class="file-info"&gt;ឯកសារ​ទាំងអស់​មាន​ចំនួន {fileState.fileResult.count}&lt;/div&gt;
            
   	&lt;div class="wrapper"&gt;
        {#each fileState.fileResult.detailedList as item}
            {#if item.fullPath == fileState.filePath}
            &lt;button id="clicked" onclick={(event)=&gt;tool.getFile(item.fullPath, event)}&gt;{item.title}&lt;/button&gt;
            {:else}
            &lt;button onclick={(event)=&gt;tool.getFile(item.fullPath, event)}&gt;{item.title}&lt;/button&gt;
            {/if}
        {/each}
    &lt;/div&gt;
&lt;/aside&gt;</code></pre><pre><code class="typescript">// src/lib/store/state.svelte.ts
export const dialogState = $state({
    showDialog: false,
    message: '',
});

interface ElementState {
    title: string;
    content: string;
    category: string;
    categories: string;
    thumb: string;
    date: string;
    bookTitle: string;
    bookThumb: string;
    bookChapter: string;
    json: string;
    type:  string;
    id: string;
    status: string;
    videos: any[];
    clicked: null | EventTarget;
}

export const eleState: ElementState = $state({
    title: '',
    content: '',
	category: 'selected',
    categories: '',
    thumb: '',
    date: '',
    bookTitle: '',
    bookThumb: '',
    bookChapter: '',
    json: '',
    type: 'YouTube',
    id: '',
    status: 'ចប់',
    videos: [],
    clicked: null
});

interface fileStateType {
    filePath: string;
    fileResult: {success: boolean, detailedList: any[], count: number}
}
export const fileState: fileStateType = $state({
    filePath: '',
    fileResult: {success: false, detailedList:[], count: 0}
})</code></pre><pre><code class="typescript">// src/routes/editor-utils.ts
import { eleState, dialogState, fileState } from '$lib/store/state.svelte';

class EditorTools{
	...
	async getFile(path: string, event: Event){
        
        eleState.clicked = event.target

        if(fileState.filePath !== path){
            const file = await (window as any).electronAPI.getFile(path);
            fileState.filePath = path
            eleState.title = file.data.title;
            eleState.content = file.content;
            (window as any).tinymce.activeEditor.setContent(file.content)
            eleState.categories = file.data.categories;
            eleState.thumb = file.data.thumb;
            eleState.date = file.data.date;
            eleState.bookTitle = file.data.bookTitle;
            eleState.bookThumb = file.data.bookThumb;
            eleState.bookChapter = file.data.bookChapter;
            eleState.json = file.data.videos;
            if(file.data.videos.length){
                eleState.videos = JSON.parse(file.data.videos);
            }else{
                eleState.videos = [];
            }

            eleState.category = 'selected';
            eleState.type = 'YouTube';
            eleState.id = '';
            eleState.status = 'ចប់';
            
        }
    }
}

export default new EditorTools()</code></pre>