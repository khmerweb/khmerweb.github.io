---
id: '925821971497890'
title: 'រក្សា​ទិន្នន័យ​ទុក'
categories: 'Node.js, Sveltekit'
thumb: ''
date: '2025-10-05T16:50:01'
bookTitle: 'Desktop App with Electron'
bookCover: ''
bookChapter: 'Electron & SvelteKit & SQLite'
videos: ''
---
<p>ដំបូង​បង្អស់ យើង​ត្រូវ​ភ្ជាប់​ទំនាក់ទំនង​រវាង​កម្មវិធី SvelteKit នឹង​ឯកសារ main.ts ដោយ​បង្កើត​ក្បួន​មួយ​នៅ​ក្នុង​ឯកសារ preload.cjs ដូច​ខាងក្រោម៖</p>
<pre class="language-javascript"><code>// electron/preload.cjs
...
contextBridge.exposeInMainWorld('electronAPI', {
...
savePost: (content, postId) =&gt; ipcRenderer.invoke('save-post', content, postId),
}</code></pre>
<p>&nbsp;</p>
<p>បន្ទាប់​មក​ទៀត នៅ​ក្នុង​ឯកសារ main.ts យើង​ត្រូវ​បង្កើត​ក្បួន​មួយ​ដូច​ខាង​ក្រោម​៖</p>
<pre class="language-typescript"><code>// electron/main.ts
...
ipcMain.handle('save-post', async (event, post, postId) =&gt; {
    if(postId.length){
        db.updatePost(postId, (JSON.parse(post)));
        return {success: true, postId};
    }else{
        const postId = db.createPost(JSON.parse(post));
        return {success: true, postId};
    }
});
...</code></pre>
<p>&nbsp;</p>
<p>ដោយ​ក្បួន​​ខាង​លើយក​វិធីឈ្មោះ db.createPost មក​ប្រើ​តាមរយៈ​សិស្ស​នៃ​ថ្នាក់​ DBTools ដូចនេះ​យើង​ត្រូវ​បង្អើត​វិធី​មួយ​មាន​ឈ្មោះ​ថា createPost នៅ​ក្នុង​ថ្នាក់​នេះ​ ក្នុង​គោលបំណង​រក្សា​ទុក​នូវ​ទិន្នន័យ​ដែល​ត្រូវ​បាន​បញ្ជូន​មក​ដោយវិធី​ខាង​លើ​។</p>
<pre class="language-typescript"><code>// electron/db-utils.ts
...
class DBTools{
    ...
    createPost(post: string[]){
        const stmt = this.db.prepare('INSERT INTO Post (id,title,content,categories,thumb,date,bookTitle,bookCover,bookChapter,videos) VALUES (?,?,?,?,?,?,?,?,?,?)');
        const id = randomUUID();
        post.unshift(id);
        const result = stmt.run(post);
        return id
    }
}</code></pre>
<p>&nbsp;</p>
<p>នៅ​ក្នុង​កម្មវិធី SvelteKit ការយក​ក្បួន​រក្សា​ទិន្នន័យ​ទុក​នៅ​ក្នុង​ឯកសារ main.ts មក​ប្រើ ​ត្រូវ​ធ្វើ​ដូច​ខាង​ក្រោម​៖</p>
<pre class="language-typescript"><code>// src/routes/editor-utils.ts
...
class EditorTools{
...
    async submitForm(event: Event){
        ...
        if(buttonId === 'md-file'){
        ...
        }else if(buttonId === 'database'){
            const post = [title, content, categories, thumb, date, bookTitle, bookCover, bookChapter, videos];
            const result = await (window as any).electronAPI.savePost(JSON.stringify(post), fileState.postId);
            if(result.success){
                dialogState.showDialog = true;
                dialogState.message = "រក្សា​ឯកសារ​ទុក​​ក្នុង​ SQLite បាន​ដោយ​​ជោគជ័យ!";
                fileState.postId = result.postId;
                fileState.itemsStatus = 'SQLite';
                fileState.fileResult = await (window as any).electronAPI.getPosts();
            }
        }
        ...
    }
...
}

export default new EditorTools()</code></pre>