---
id: '57250409'
title: 'លេខ​ទំព័រ​ជំពូក'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-09-02T17:41:48'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ជំពូក'
videos: ''
---
<p>ការ​ចុះ​លេខ​ទំព័រ​ជំពូក​​ក៏​មិន​ខុស​គ្នា​ពី​ការចុះ​លេខ​ទំព័រ​ដទៃ​ទៀត​ដែរ គឺ​ត្រូវ​យក​ចំនួន​សរុប​ទាំងអស់​នៃ​ទិន្នន័យ​នៃ​ជំពូក​​មក​ចែក​នឹង​ចំនួន​ជំពូក​​សំរាប់​ទំព័រ​និមួយ​ៗ​។ ការចែក​នេះ​​ត្រូវ​ធ្វើឡើងដោយ​ការយក​​ក្បួន​គណិត​វិទ្យា Math.ceil( ) ​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​នៅក្នុង​កញ្ចប់ ES6 ​មក​ប្រើ​។ ប្រមាណ​វិធី​នេះ​ត្រូវ​ធ្វើ​ឡើង​នៅ​ក្នុង​ឯកសារ [id].astro នៃ​ថត src/pages/admin/category/edit ។</p><pre><code class="js javascript js-code">// models/category.js
import prisma from './prisma.js'

class Category{
	...
	async paginate(page, amount){
        const categories = await prisma.category.findMany({ 
            orderBy: { date: "desc" },
            skip: amount*(page-1),
            take: amount
        })

        return categories
    }
}

export default new Category()</code></pre><pre><code class="js javascript js-code">// src/pages/admin/category/paginate/[page].js
import categoryDb from "../../../../models/category.js"
import setup from "../../../../settings.js"

export async function GET({ params }) {
    const page = parseInt(params.page)
    const settings = await setup()
    const items = await categoryDb.paginate(page, settings.dashboard)
    
    return new Response(
        JSON.stringify(items)
    )
}</code></pre><pre><code class="js javascript js-code">&lt;!--src/pages/admin/category/edit/[id].js--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../../../components/admin/Layout.astro"
import Category from "../../../../components/admin/Category-edit.svelte"
import categoryDb from "../../../../models/category.js"
import setup from "../../../../settings.js"

let form = null

if(Astro.request.method === "POST"){
    form = {}
    const formData = await Astro.request.formData()
    const title = formData.get('label')
    const thumb = formData.get("thumb")
    const date = formData.get("datetime")

    const validate = (
        typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
        typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
        typeof date === 'string' &amp;&amp; date !== ''
    )

    if(validate){
        const category = {title, thumb, date}
        if(user.role == 'Admin'){
            await categoryDb.updateCategory(category, Astro.params)
            form.info = 'ជំពូក​​​ត្រូវ​បាន​កែប្រែ!'
            form.success = true
        }else{
            form.info = 'អ្នក​គ្មាន​សិទ្ធិ​កែប្រែ​ជំពូក​ឡើយ!'
            form.success = false
        }
    }else{
        form.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
        form.success = false
    }
}

const settings = await setup()
const params = Astro.url.searchParams
const navPage = params.get("p")
const category = await categoryDb.getCategory(Astro.params)
const items = await categoryDb.paginate(parseInt(navPage), settings.dashboard)
const count = await categoryDb.count()
const pageNumber = Math.ceil(count/settings.dashboard)

const data = {user, count, category, items, info:"ជំពូក", type:"category", pageNumber, form, navPage}
---

&lt;Layout title="កែប្រែជំពូក" data={data} &gt;
    &lt;Category slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>