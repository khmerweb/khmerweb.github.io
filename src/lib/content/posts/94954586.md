---
id: '94954586'
title: 'លុប​ការផ្សាយ'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-08-31T12:07:59'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ការផ្សាយ'
videos: ''
---
<p>ការលុប​ទិន្នន័យ​នៃ​ការផ្សាយអាច​​ត្រូវ​ធ្វើឡើង​តាម​រយៈ​ក្បួន​ចុង​​ផ្លូវ​ឬ API Route នៅ​ក្នុង​ថត src/pages/admin/post/delete ។ ក្បួន​ចុង​ផ្លូវ​នោះ​អាច​ជា​ឯកសារ​មាន​ឈ្មោះ​ថា [id].js ដែល​នឹង​ត្រូវ​ទទួល​យក​ប៉ារ៉ាម៉ែត id មក​ប្រើប្រាស់​ក្នុង​​ការ​លុប​ទិន្នន័យ​នៃ​ការផ្សាយ​ដែល​មាន​អត្តសញ្ញាណ​​ដូច​​គ្នា​ទៅនឹង​​ប៉ារ៉ាម៉ែត​ id នៅ​ក្នុង​​មូលដ្ឋាន​ទិន្នន័យ។&nbsp;</p><p>&nbsp;</p><p>ទន្ទឹម​នឹង​នេះ ការលុប​ទិន្នន័យ​នៃ​ការផ្សាយ​ត្រូវ​ធ្វើ​ឡើង​ដោយ​មានការ​ត្រួត​ពិនិត្យ​មើល​ថា​តើ​អ្នក​និពន្ធ​ដែល​ចង់​លុប​​ទិន្នន័យ​ណា​មួយ​នោះ មាន​សិទ្ធិក្នុង​ការ​ធ្វើ​ដូច​នេះ​ដែរ​ឬ​ទេ​។ ពោល​គឺ​ត្រួត​ការពិនិត្យ​​ត្រូវ​ធ្វើ​ឡើង​ដោយ​ការពិនិត្យ​មើល​តួនាទី​របស់​អ្នក​និពន្ធ​។</p><p>&nbsp;</p><p>មួយវិញទៀត ​អ្នក​និពន្ធ​ទាំងឡាយ​ដែល​មាន​តួនាទី​ត្រឹម​តែ​ជា «Author» ​​​​​​នឺងមាន​សិទ្ធិ​លុប​តែ​ការផ្សាយ​ទាំងឡាយ​ដែល​ត្រូវ​បាន​តែង​និពន្ធ​ដោយ​ខ្លួន​គេ​ផ្ទាល់​តែប៉ុណ្ណោះ​​ ពួក​គេ​​នឹង​មិន​អាច​លុប​​អត្ថបទនៃ​​ការផ្សាយ​របស់​អ្នក​ដទៃ​បាន​ឡើយ​។ មាន​តែ​អ្នក​និពន្ធ​ដែល​មាន​តួនាទី​ជា « Admin» ប៉ុណ្ណោះ ដែល​មាន​សិទ្ធិ​លុប​​អត្ថបទ​នៃ​ការផ្សាយ​ណា​ក៏​បាន​។</p><pre><code class="js javascript js-code">// src/models/post.js
import prisma from './prisma.js'

class Post{
	...
    async count(query={}){
        return await prisma.post.count(query)
    }

    async getPosts(amount){
        return await prisma.post.findMany({ 
            take: amount, 
            orderBy: { date: "desc" }
        })
    }

    async getPost(params){
        return await prisma.post.findUnique({ where: {id: params.id }})
    }

    async deletePost(params){
        await prisma.post.delete({ where: {id: params.id } })
    }
}

export default new Post()</code></pre><pre><code class="js javascript js-code">// src/pages/admin/post/delete/[id].js
import postDb from "../../../../models/post.js"

export async function GET({ session, params, redirect, cookies }){
    const user = await session.get('user')
    if(!user){return redirect('/login')}
    
    const post = await postDb.getPost(params)

    if(user.role !== 'Admin'){
        if(post.author === user.id){
            await postDb.deletePost(params)
            cookies.set('form', JSON.stringify({success:true, info:'លុប​បាន​ដោយ​ជោគជ័យ!'}), { path: '/' })
        }else{
            cookies.set('form', JSON.stringify({success:false, info:'អ្នក​មិន​អាច​លុប​ការផ្សាយ​របស់​អ្នក​ផ្សេង​បាន​ឡើយ​!'}), { path: '/' })
        }
    }else if(user.role === 'Admin'){
        await postDb.deletePost(params)
        cookies.set('form', JSON.stringify({success:true, info:'លុប​បាន​ដោយ​ជោគជ័យ!'}), { path: '/' })
    }

    return redirect('/admin/post')
}</code></pre><pre><code class="js javascript js-code">&lt;!--src/pages/admin/post/index.astro--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../../components/admin/Layout.astro"
import Post from "../../../components/admin/Post.svelte"
import postDb from "../../../models/post.js"
import setup from "../../../settings.js"
const settings = await setup()
const items = await postDb.getPosts(settings.dashboard)
const count = await postDb.count()
const pageNumber = Math.ceil(count/settings.dashboard)
const categories = [] 

const data = { user, count, settings, items, categories, info:"ការផ្សាយ", type:"post", pageNumber }
const form = Astro.cookies.get('form')
if(form){
    data.form = JSON.parse(form.value)
    Astro.cookies.delete("form", { path: '/' })
}

if(Astro.request.method === "POST"){
    let message = {}
    const formData = await Astro.request.formData()
    const title = formData.get('title')
    const content = formData.get('content')
    const categories = formData.get('categories')
    const thumb = formData.get("thumb")
    const datetime = formData.get("datetime")
    const videos = formData.get("videos")

    const validate = (
        typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
        typeof content === 'string' &amp;&amp;
        typeof categories === 'string' &amp;&amp; categories !== '' &amp;&amp;
        typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
        typeof datetime === 'string' &amp;&amp; datetime !== '' &amp;&amp;
        typeof videos === 'string'
    )

    if(validate){
        const post = {title, content, categories, thumb, datetime, videos}
        await postDb.createPost(post, user)
        message.info = 'ការផ្សាយ​មួយ​ត្រូវ​បាន​បង្កើត​ឡើង!'
        message.success = true
    }else{
        message.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
        message.success = false
    }

    data.items = await postDb.getPosts(settings.dashboard)
    data.count = await postDb.count()
    data.pageNumber = Math.ceil(count/settings.dashboard)
    data.form = message
}
---
 
&lt;Layout title="ទំព័រ​ការផ្សាយ" data={data} &gt;
    &lt;Post slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>