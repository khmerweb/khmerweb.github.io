---
id: '72433831'
title: 'លេខ​ទំព័រ​ការផ្សាយ'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-08-31T21:51:59'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ការផ្សាយ'
videos: ''
---
<p>ការដាក់លេខ​ទំព័រ​ដែល​ភាសា​អង់គ្លេស​ហៅ​ថា pagination គឺ​ជា​ការចែក​បណ្តុំ​ទិន្នន័យ​ជា​ទំព័រ ហើយ​នៅ​ក្នុង​ទំព័រ​និមួយ​ៗ ​អាច​មាន​ចំនួន​ការផ្សាយ​អាស្រ័យ​ទៅ​តាម​ការកំណត់​របស់​អ្នក​និពន្ធ​ដែល​មាន​តួនាទី​ជា Admin ។ ​ចំនួន​ទំព័រ​គឺ​ជា​ផល​ចែក​រវាង​ចំនួន​ការផ្សាយ​ទាំងអស់​នឹង​ចំនួន​កំណត់​នៃ​ការផ្សាយ​សំរាប់​ទំព័រ​និមួយ​ៗ​។ ឧទាហរណ៍ បើ​ការផ្សាយ​ទាំងអស់​មាន​ចំនួន 100 និង​ចំនួន​កំណត់​នៃ​ការផ្សាយ​សំរាប់​ទំព័រ​និមួយ​ៗ​គឺ 10 ដូចនេះ​ផល​ចែក​រវាង​លេខ​ទាំងពីរ​នេះ​គឺ 100/10​ = 10 ​​​​​​​​ទំព័រ។ បើ​មាន​សំណល់​ក៏​ត្រូវ​គិត​ថា​មួយ​ទំព័រ​ដែរ​​ដូច​ជា 101/10 = 11 ទំព័រ​។ លេខ​ចែក​របៀប​នេះ​បាន​មក​ពី​ក្បួន​គណិតវិទ្យា Math.ceil( ) នៅ​ក្នុង​កញ្ចប់ JavaScript ។ ការរាប់ចំនួន​ការផ្សាយ​សរុប​ត្រូវ​ធ្វើ​ឡើង​​ដោយ​វិធី count( ) នៅ​ក្នុង​កញ្ចប់ Prisma ដែល​ត្រូវ​បាន​បង្កើត​ឡើង​នៅ​ក្នុង​តម្រា src/models/post.js ។</p><pre><code class="js javascript js-code">// src/models/post.js
class Post{
	async count(query={}){
        return await prisma.post.count(query)
    }
    ...
}

export default new Post()</code></pre><p>&nbsp;</p><p>ការបង្កើត​លេខ​ទំព័រ​ធ្វើ​ឡើងដោយ​យោង​ទៅ​តាម​ចំនួន​ទំព័រ​សរុប​បាន​មក​ពី​ការចែក​​ដូច​​រៀបរាប់​ខាង​លើ និង​បំបែក​វា​អោយ​ទៅ​ជា​កំរង​ទិន្នន័យ​មួយ​ដែល​នៅ​ក្នុង​នោះ​ ធាតុ​និមួយ​ៗ​ជា​លេខ​សំរាប់​ទំព័រ​និមួយ​ៗ​។</p><pre><code>&lt;!--src/components/admin/Item.svelte--&gt;
...
&lt;div class="pagination"&gt;
	&lt;span&gt;​​​​​​​​​​​​​​​​​​​​​ទំព័រ &lt;/span&gt;
	&lt;select bind:value onchange={paginate}&gt; 
		{#each [...Array(data?.pageNumber).keys()] as page}
			{#if page+1 == parseInt(navPage)}
			&lt;option selected&gt;{page+1}&lt;/option&gt;
			{:else}
			&lt;option&gt;{page+1}&lt;/option&gt;
			{/if}
		{/each}
	&lt;/select&gt; 
    &lt;span&gt;នៃ {data?.pageNumber}&lt;/span&gt;
&lt;/div&gt;</code></pre><p>&nbsp;</p><p>ការស្រង់​យក​ទិន្នន័យ​សំរាប់​ទំព័រ​និមួយ​ៗ​ ធ្វើ​ឡើង​ដោយ​អាស្រ័យ​ទៅ​តាមលេខ​របស់​ទំព័រទិន្នន័យ​ គឺ​ត្រូវ​យក​លេខ​ទំព័រ​មក​គុន​នឹងចំនួន​ការផ្សាយ​​សំរាប់​ទំព័រ​និមួយ​ៗ​។ បើ​លេខ​ទំព័រ​គឺ 3 និង​ចំនួន​ទិន្នន័យ​សំរាប់​ទំព័រ​និមួយ​ៗ​គឺ 10 ដូចនេះ​យើង​ត្រូវ​រំលង​ទិន្នន័យ​ចំនួន 10*(3-1) ​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​នៅក្នុង​មូលដ្ឋាន​​ទិន្នន័យ ​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​មុន​នឹង​ស្រង់​យក​ទិន្នន័យ​សំរាប់​​ទំព័រ​លេខ 3 នេះ​។</p><pre><code class="js javascript js-code">// src/models/post.js
class Post{
	...
	async paginatePosts(page, amount){
        const posts = await prisma.post.findMany({ 
            orderBy: { date: "desc" },
            skip: amount * (page-1),
            take: amount,
        })

        return posts
    }
}

export default new Post()</code></pre><p>&nbsp;</p><p>ចំពោះ​ទំព័រ​កែប្រែ​ការផ្សាយ​ដែល​ជា​ទំព័រ [id].astro យើង​ក៏​ត្រូវ​ប្តូរ​ពីការស្រង់​យក​ទិន្នន័យ​ថ្មី​ជាង​គេ មកជា​ការស្រង់​យក​ទិន្នន័យ​សំរាប់​ទំព័រ​និមួយ​ៗ​វិញ ដោយ​ធ្វើ​ដូច​ខាង​ក្រោម​នេះ៖</p><pre><code class="js javascript js-code">&lt;!--src/admin/post/edit/[id].astro--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../../../components/admin/Layout.astro"
import Post from "../../../../components/admin/Post-edit.svelte"
import postDb from "../../../../models/post.js"
import setup from "../../../../settings.js"
const settings = await setup()
const params = Astro.url.searchParams
const navPage = params.get("p")
const items = await postDb.paginatePosts(parseInt(navPage), settings.dashboard)
const count = await postDb.count()
const post = await postDb.getPost(Astro.params)
const pageNumber = Math.ceil(count/settings.dashboard)
const categories = [] //await categoryDB.getAllItems(locals)

const data = { user, post, count, settings, items, categories, info:"ការផ្សាយ", type:"post", pageNumber, navPage }

if(Astro.request.method === "POST"){
    let message = {}
    const formData = await Astro.request.formData()
    const title = formData.get('title')
    const content = formData.get('content')
    const categories = formData.get('categories')
    const thumb = formData.get("thumb")
    const date = formData.get("datetime")
    const videos = formData.get("videos")

    const validate = (
        typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
        typeof content === 'string' &amp;&amp;
        typeof categories === 'string' &amp;&amp; categories !== '' &amp;&amp;
        typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
        typeof date === 'string' &amp;&amp; date !== '' &amp;&amp;
        typeof videos === 'string'
    )

    if(validate){
        const newPost = { title, content, categories, thumb, date, videos }
        if(user.role !== 'Admin'){
            if(post.author === user.id){
                await postDb.updatePost(newPost, Astro.params)
                message.info = 'កែប្រែ​បាន​ដោយ​ជោគជ័យ!'
                message.success = true
            }else{
                message.info = 'អ្នក​មិន​អាច​កែប្រែ​ការផ្សាយ​របស់​អ្នក​ផ្សេង​បាន​ឡើយ!'
                message.success = false
            }
        }else if(user.role === 'Admin'){
            await postDb.updatePost(newPost, Astro.params)
            message.info = 'កែប្រែ​បាន​ដោយ​ជោគជ័យ!'
            message.success = true
        }
    }else{
        message.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
        message.success = false
    }

    data.post = await postDb.getPost(Astro.params)
    data.items = await postDb.paginatePosts(parseInt(navPage), settings.dashboard)
    data.form = message
}
---

&lt;Layout title="កែប្រែ​ការផ្សាយ" data={data} &gt;
    &lt;Post slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>