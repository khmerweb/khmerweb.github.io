---
id: '50581737'
title: 'ទិន្នន័យ​ការផ្សាយ'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-08-30T22:39:48'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ការផ្សាយ'
videos: ''
---
<p>បន្ទាប់​ពី​បាន​បញ្ចូល​ទិន្នន័យ​នៃ​ការផ្សាយ​​ទៅ​ក្នុង​មូលដ្ឋាន​ទិន្នន័យ​រួច​ហើយ យើង​អាច​ស្រង់​យក​ទិន្នន័យ​ទាំងនោះ​មក​បង្ហាញ​នៅ​លើ​​ផ្នែក​ខាង​ក្រោម​នៃ​ទំព័រ​គ្រប់គ្រង​ ដោយ​សរសេរ​កូដ​​​ដូច​ខាង​ក្រោម​នេះ​​៖</p><pre><code class="js javascript js-code">// src/models/post.js
import prisma from './prisma.js'

class Post{
    async count(query={}){
        return await prisma.post.count(query)
    }

    async getPosts(amount){
        return await prisma.post.findMany({ 
            take: amount, 
            orderBy: { date: "desc" }
        })
    }
}

export default new Post()</code></pre><pre><code class="js javascript js-code">// src/settings.js
async function setup(){
    let setting = null
    let settings = {}

    if(setting){
        settings = {
            siteTitle: setting.title,
            description: setting.description,
            dashboard: setting.dashboard,
            frontend: setting.frontend,
            categories: setting.categories,
            playlist: setting.playlist,
            thumb: '',
            date: ''
        }
    }else{
        settings = {
            siteTitle: 'ដំណឹង​ល្អ',
            description: 'description',
            dashboard: 10,
            frontend: 20,
            categories: 20,
            playlist: 20,
            thumb: '',
            date: ''
        }
    }
    
    return settings
}
 
export default setup</code></pre><pre><code class="js javascript js-code">&lt;!--src/pages/admin/post.astro--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../components/admin/Layout.astro"
import Post from "../../components/admin/Post.svelte"
import postDb from "../../models/post.js"
import setup from "../../settings.js"
const settings = await setup()
const items = await postDb.getPosts(settings.dashboard)
const count = await postDb.count()
const pageNumber = Math.ceil(count/settings.dashboard)
const categories = []

const data = { user, count, settings, items, categories, info:"ការផ្សាយ", type:"post", pageNumber }

if(Astro.request.method === "POST"){
    let message = {}
    const formData = await Astro.request.formData()
    const title = formData.get('title')
    const content = formData.get('content')
    const categories = formData.get('categories')
    const thumb = formData.get("thumb")
    const datetime = formData.get("datetime")
    const videos = formData.get("videos")

    const validate = (
        typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
        typeof content === 'string' &amp;&amp;
        typeof categories === 'string' &amp;&amp; categories !== '' &amp;&amp;
        typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
        typeof datetime === 'string' &amp;&amp; datetime !== '' &amp;&amp;
        typeof videos === 'string'
    )

    if(validate){
        const post = {title, content, categories, thumb, datetime, videos}
        await postDb.createPost(post, user)
        message.info = 'ការផ្សាយ​មួយ​ត្រូវ​បាន​បង្កើត​ឡើង!'
        message.success = true
    }else{
        message.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
        message.success = false
    }

    data.items = await postDb.getPosts(settings.dashboard)
    data.count = await postDb.count()
    data.pageNumber = Math.ceil(count/settings.dashboard)
    data.form = message
}
---
 
&lt;Layout title="ទំព័រ​ការផ្សាយ" data={data} &gt;
    &lt;Post slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>