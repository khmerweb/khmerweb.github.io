---
id: '15992644'
title: 'កែប្រែ​ជំពូក'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-09-02T15:40:19'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ជំពូក'
videos: ''
---
<p>ការកែប្រែ​ជំពូក​​ក៏​ត្រូវ​ធ្វើ​ឡើង​ជា​ពីរ​ដំណាក់កាល​ដែរ ដំណាក់កាល​ទី​មួយ​គឺ​ត្រូវ​ស្រង់​យក​ទិន្នន័យ​នៃ​ជំពូក​​ត្រូវ​កែប្រែ​​មក​ដាក់​បង្ហាញ​នៅ​លើ​គំរូ​ទំព័រ​ជំពូក​។ ដំណាក់កាល​ទី​ពីរ​គឺ​ការកែប្រែ​ទិន្នន័យ​នៃ​ជំពូក​​នេះ និង​បញ្ជូន​វា​ទៅ​រក្សា​ទុក​នៅ​ក្នុង​មូលដ្ឋាន​ទិន្នន័យ ជំនួស​អោយ​ទិន្នន័យ​នៃ​ជំពូក​​ចាស់​។ ការស្រង់​យក​និង​ការកែប្រែ​ទិន្នន័យ​នៃ​ជំពូក អាច​ត្រូវ​ធ្វើ​ឡើង​នៅ​ក្នុង​​ឯកសារ [id].astro នៅ​ក្នុង​ថត src/pages/admin/category/edit។</p><pre><code class="js javascript js-code">// models/category.js
import prisma from './prisma.js'

class Category{
	...
	async getCategory(params){
        return await prisma.category.findUnique({ where: {id: params.id }})
    }
    
    async updateCategory(category, params){
        const updatedCategory = {
            title: category.title,
            thumb: category.thumb,
            date: category.date,
        }
        
        await prisma.category.update({ where: {id: params.id }, data: updatedCategory })
    }
	...
}

export default new Category()</code></pre><pre><code class="js javascript js-code">&lt;!--src/components/admin/Category-edit.svelte--&gt;
&lt;script&gt;
    import jq from 'jquery'
    import { activePage } from "../../stores/page.js"
    let { data } = $props()

    function save_data_check(){   
        return "Your changes may not be saved."
    }

    $effect(()=&gt;{
        jq('.category input').on('change', () =&gt; {
            window.onbeforeunload = save_data_check
        })
    })

    function submitForm(){
        window.onbeforeunload = null
    }
&lt;/script&gt;

&lt;section class="category"&gt;
    &lt;form method="post" action="/admin/category/edit/{data.category.id}?p={$activePage}" onsubmit={submitForm} &gt;
        &lt;span&gt;ឈ្មោះ​ជំពូកៈ&lt;/span&gt;&lt;input type="text" name="label" value={data.category.title} required /&gt;
        &lt;span&gt;រូប​សញ្ញាៈ&lt;/span&gt;&lt;input type="text" name="thumb" value={data.category.thumb} required /&gt;
        &lt;span&gt;ពេល​បង្កើតៈ&lt;/span&gt;&lt;input type="datetime-local" step="1" name="datetime" value={data.category.date} required /&gt;
        &lt;span&gt;&lt;/span&gt;&lt;input type="submit" value="បញ្ជូន" /&gt;
        &lt;span&gt;&lt;/span&gt;
    &lt;/form&gt;
&lt;/section&gt;

&lt;style&gt;
    .category{
        padding: 20px;
        background: var(--background);
        height: 100%;
    }
    .category form{
        display: grid;
        grid-template-columns: 80px 300px;
        grid-gap: 5px 2px;
        align-items: center;
    }
    .category form span{
        text-align: right;
        color: black;
    }
    .category form input{
        font: var(--body-font);
        padding: 2px 5px
    }
&lt;/style&gt;</code></pre><pre><code class="js javascript js-code">&lt;!--src/pages/admin/category/edit/[id].js--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../../../components/admin/Layout.astro"
import Category from "../../../../components/admin/Category-edit.svelte"
import categoryDb from "../../../../models/category.js"
import setup from "../../../../settings.js"

let form = null

if(Astro.request.method === "POST"){
    form = {}
    const formData = await Astro.request.formData()
    const title = formData.get('label')
    const thumb = formData.get("thumb")
    const date = formData.get("datetime")

    const validate = (
        typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
        typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
        typeof date === 'string' &amp;&amp; date !== ''
    )

    if(validate){
        const category = {title, thumb, date}
        if(user.role == 'Admin'){
            await categoryDb.updateCategory(category, Astro.params)
            form.info = 'ជំពូក​​​ត្រូវ​បាន​កែប្រែ!'
            form.success = true
        }else{
            form.info = 'អ្នក​គ្មាន​សិទ្ធិ​កែប្រែ​ជំពូក​ឡើយ!'
            form.success = false
        }
    }else{
        form.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
        form.success = false
    }
}

const settings = await setup()
const category = await categoryDb.getCategory(Astro.params)
const items = await categoryDb.getCategories(settings.dashboard)
const count = await categoryDb.count()
const pageNumber = Math.ceil(count/settings.dashboard)

const data = {user, count, category, items, info:"ជំពូក", type:"category", pageNumber, form}
---

&lt;Layout title="កែប្រែជំពូក" data={data} &gt;
    &lt;Category slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>