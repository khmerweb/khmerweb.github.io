---
id: '08043971'
title: 'ស្រង់​យក​ឯកសារ MD'
categories: 'Node.js, Sveltekit'
thumb: ''
date: '2025-10-01T12:41:03'
bookTitle: 'Desktop App with Electron'
bookThumb: ''
bookChapter: 'Electron & SvelteKit'
videos: ''
---
<p>ក្រោយ​ពី​ត្រូវ​បាន​រក្សា​ទុក​រួច​ហើយ យើង​អាច​ស្រង់​យកឯកសារ​ទាំងនោះ​ មក​បង្ហាញ​នៅ​លើ​ផ្ទាំង​ខាង​ឆ្វេងនៃ​កម្មវិធី md-editor របស់​យើង​បាន​គ្រប់​ពេល​វេលា ដោយ​សរសេរ​កូដ​ដូច​ខាង​ក្រោម​នេះ៖</p><pre><code class="typescript">// electron/preload.cjs
const { contextBridge, ipcRenderer } = require('electron')

contextBridge.exposeInMainWorld('electronAPI', {
    getWindowHeight: () =&gt; ipcRenderer.invoke('get-window-height'),
    onUpdateWindowHeight: (callback) =&gt; ipcRenderer.on('update-window-height', callback),
    saveFile: (fileContent, filePath) =&gt; ipcRenderer.invoke('save-file', fileContent, filePath),
    getFiles: () =&gt; ipcRenderer.invoke('get-files'),
})</code></pre><pre><code class="typescript">// electron/main.ts
import { app, BrowserWindow, Menu, ipcMain, dialog } from 'electron';
...
import fileTools from "./file-utils.ts";

ipcMain.handle('get-files', async (event) =&gt; {
    const result = await fileTools.getFiles();
    return result
})
...</code></pre><p>&nbsp;</p><p>បន្ទាប់​មក​ទៀត​ យើង​ចាំបាច់​ត្រូវ​តំលើង​កញ្ចប់ gray-matter មួយ​ទៀត​មុន​នឹង​សរសេរ​កូដ​សំរាប់​នាំ​យក​ទៅ​ប្រើ​នៅ​ក្នុង​ក្បួន​ខាង​លើ​។</p><pre><code>npm install gray-matter</code></pre><pre><code class="typescript">// electron/file-utils.ts
...
import matter from 'gray-matter';
import Store from 'electron-store';
interface FolderPath {
    folderPath: string;
}
const store = new Store&lt;FolderPath&gt;();

class FileTools{
	...
	async getFiles(){
        const folderPath = store.get('folderPath');
        
        try {
            const allFiles = fs.readdirSync(folderPath)
            const file_folder = allFiles.filter(item =&gt; {
                const systemIgnores = [
                    'desktop.ini',
                    'Thumbs.db',
                    '$Recycle.Bin',
                    'System Volume Information',
                    'pagefile.sys',
                    'hiberfil.sys'
                ]

                if (systemIgnores.includes(item)) {
                    return false
                }

                return !item.startsWith('.')
            })

            const files = file_folder.filter(name =&gt; {
                const fullPath = path.join(folderPath, name);
                const stats = fs.statSync(fullPath);
                const extension = name.slice(-3)
                return !stats.isDirectory() &amp;&amp; extension === '.md';
            })

            let detailedList = files.map(name =&gt; {
                const fullPath = path.join(folderPath, name);
                const stats = fs.statSync(fullPath);
                const data = fs.readFileSync(fullPath, 'utf8');
                const result = matter(data);
                
                return {
                    title: result.data.title,
                    name: name,
                    fullPath: fullPath,
                    isDirectory: stats.isDirectory(),
                    modifiedTime: stats.mtime.getTime() 
                }
            })
        
        const count = detailedList.length
        detailedList.sort((a, b) =&gt; b.modifiedTime - a.modifiedTime)
        return { success: true, detailedList, count }
        
        } catch (err: any) {
            console.error('Error reading directory:', err)
            return { success: false, error: err.message }
        }
    }
}

export default new FileTools()</code></pre><pre><code class="typescript">// src/routes/editor-utils.ts
import { eleState, dialogState, fileState } from '$lib/store/state.svelte';

class EditorTools{
	...
	async getFiles(){
        fileState.fileResult = await (window as any).electronAPI.getFiles()
    }
}

export default new EditorTools()</code></pre><pre><code class="svelte">&lt;!--src/routes/+page.svelte--&gt;
&lt;script lang="ts"&gt;
...
import tool from "./editor-utils";
import { eleState, fileState } from '$lib/store/state.svelte';
...
$effect(()=&gt;{
    tool.updateWindowHeight();
    tool.getFiles();
});
&lt;/script&gt;

...
&lt;aside&gt;
    &lt;div class="file-info"&gt;ឯកសារ​ទាំងអស់​មាន​ចំនួន {fileState.fileResult.count}&lt;/div&gt;
            
    &lt;div class="wrapper"&gt;
    	{#each fileState.fileResult.detailedList as item}
        &lt;button&gt;{item['title']}&lt;/button&gt;
        {/each}
    &lt;/div&gt;
&lt;/aside&gt;

&lt;style&gt;
...
aside{
    background: lightgrey;
}
aside .file-info{
    text-align: center;
    padding: 7px 0;
    font-weight: normal;
    background: var(--menu);
    color: black;
}
aside .wrapper{
    padding: 15px;
}
aside button{
    all: unset;
    display: block;
}
...
&lt;/style&gt;</code></pre><p>&nbsp;</p><figure class="image"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgTIiisB95jWpbJWMhJO6A-Cg4ICaNvDFU3FGq3mR18Ay4S26CA6qaT5FYc2DNhfRnBVsjhuM-ip65huBYdUZn6eXFplAxaWh9cUCGocj84GReglnoNhBBo0fz7rVl2oU0Gn2s01tnG7usMRxgG6FxBCudBUGpl4bXjxs2HCJgjc9rg5I9RvsvpN6Q6aIY/s1600/Capture.PNG"></figure>