---
id: '91273201'
title: 'បង្កើត​ការផ្សាយ'
categories: 'Node.js, Astro'
thumb: ''
date: '2025-08-30T16:54:38'
bookTitle: 'Astro Dynamic Website'
bookThumb: ''
bookChapter: 'ទំព័រ​ការផ្សាយ'
videos: ''
---
<p>យន្តការ​បង្កើត​ការផ្សាយ (create post) ធ្វើ​ឡើង​ដោយ​ការបញ្ជូន​ទិន្នន័យ​មាន​នៅ​ក្នុង​ទំរង់បែបបទ​នៃ​ទំព័រ​ការផ្សាយ ទៅ​រក្សាទុក​នៅ​ក្នុង​មូលដ្ឋាន​ទិន្នន័យ។ ទិន្នន័យ​ទាំងឡាយ​ត្រូវ​ត្រួត​ពិនិត្យ​ពីរ​ដង ការត្រួត​ពិនិត្យ​លើក​ទី​មួយ​ត្រូវ​ធ្វើ​ឡើង​នៅ​ក្នុង browser ការត្រួតពិនិត្យ​លើក​ទី​ពីរ​ គឺ​ត្រូវ​ធ្វើ​ឡើង​​នៅ​លើ server ​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​។ បើ​ទិន្នន័យ​ទាំងនោះ​សម​ស្រប​ទៅ​តាម​ការកំណត់​ហើយ យើង​អាច​បញ្ជូន​វា​ទៅ​រក្សា​ទុក​ក្នុង​មូលដ្ឋាន​ទិន្នន័យបាន​។ ការបញ្ជូន​នេះ​ត្រូវ​ធ្វើ​​ឡើង​តាម​រយៈ​ក្បួន​ខ្នាត​នៅ​​ក្នុង​ឯកសារ post.js នៅ​ក្នុង​ថត src/models។ ទិន្នន័យ​ការផ្សាយ​ត្រូវ​បាន​បញ្ចូល​ទៅ​ក្នុង​មូលដ្ឋាន​ទិន្នន័យ​តាម​រយៈ​អថេរ prisma ។</p><pre><code class="js javascript js-code">// src/models/post.js
import prisma from './prisma.js'

class Post{
    async createPost(post, user){
        let new_post = {}
        const expireTime = 1000 * 60 * 60 * 24 * 30 * 3

        if(post.categories.includes('news')){
            new_post = {
                id: crypto.randomUUID(),
                title: post.title,
                content: post.content,
                categories: post.categories,
                thumb: post.thumb,
                date: post.datetime,
                videos: post.videos,
                author: user.id,
                expiration: new Date(new Date().getTime() + expireTime),
            }
       
        }else{ 
            new_post = {
                id: crypto.randomUUID(),
                title: post.title,
                content: post.content,
                categories: post.categories,
                thumb: post.thumb,
                date: post.datetime,
                videos: post.videos,
                author: user.id,
            }
        }
        
        await prisma.post.create({ data: new_post })
    }

}

export default new Post()</code></pre><pre><code class="js javascript js-code">&lt;!--src/pages/admin/post.astro--&gt;
---
// @ts-nocheck
const user = await Astro.session?.get('user')
if(!user){return Astro.redirect('/login')}

import Layout from "../../components/admin/Layout.astro"
import Post from "../../components/admin/Post.svelte"
const data = {}

import postModel from "../../models/post.js"
let message = {}
if(Astro.request.method === "POST"){
    const formData = await Astro.request.formData()
    const title = formData.get('title')
        const content = formData.get('content')
        const categories = formData.get('categories')
        const thumb = formData.get("thumb")
        const datetime = formData.get("datetime")
        const videos = formData.get("videos")

        const validate = (
            typeof title === 'string' &amp;&amp; title !== '' &amp;&amp;
            typeof content === 'string' &amp;&amp;
            typeof categories === 'string' &amp;&amp; categories !== '' &amp;&amp;
            typeof thumb === 'string' &amp;&amp; thumb !== '' &amp;&amp;
            typeof datetime === 'string' &amp;&amp; datetime !== '' &amp;&amp;
            typeof videos === 'string'
        )

        if(validate){
            const post = {title, content, categories, thumb, datetime, videos}
            await postModel.createPost(post, user)
            message.info = 'ការផ្សាយ​មួយ​ត្រូវ​បាន​បង្កើត​ឡើង!'
            message.success = true
        }else{
            message.info = "ទិន្នន័យ​បញ្ជូន​មក​មិន​ត្រឹមត្រូវ​ទេ!"
            message.success = false
        }
        
    data.form = message
}
---
 
&lt;Layout title="ទំព័រ​ការផ្សាយ" data={data} user={user} &gt;
    &lt;Post slot="editor" {data} client:load /&gt;
&lt;/Layout&gt;</code></pre><p>&nbsp;</p><p>Netlify: <a href="https://khmerweb-dynamic-blog.netlify.app/login">https://khmerweb-dynamic-blog.netlify.app/login</a></p><p>GitHub: <a href="https://github.com/khmerweb/dynamic-blog">https://github.com/khmerweb/dynamic-blog</a></p>